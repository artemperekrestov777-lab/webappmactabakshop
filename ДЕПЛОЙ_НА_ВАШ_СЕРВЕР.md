# 🚀 Деплой МакТабак на ваш сервер

## 📋 Данные сервера:
- **IP:** 85.198.83.41
- **Пользователь:** root
- **Пароль:** f3-YmUt2AP-JYt

## 🔧 Команды для выполнения:

### 1. Подключение к серверу
```bash
ssh root@85.198.83.41
# Ввести пароль: f3-YmUt2AP-JYt
```

### 2. Установка Node.js (если не установлен)
```bash
# Обновляем систему
apt update -y

# Устанавливаем Node.js 18
curl -fsSL https://deb.nodesource.com/setup_18.x | bash -
apt-get install -y nodejs

# Проверяем установку
node --version
npm --version
```

### 3. Клонирование репозитория
```bash
# Переходим в домашнюю директорию
cd /root

# Клонируем репозиторий
git clone https://github.com/artemperekrestov777-lab/webappmactabakshop.git

# Переходим в папку проекта
cd webappmactabakshop
```

### 4. Установка зависимостей
```bash
# Устанавливаем зависимости
npm install

# Устанавливаем PM2 для управления процессами
npm install -g pm2
```

### 5. Создание .env файла
```bash
# Создаем .env файл
cat > .env << 'EOF'
BOT_TOKEN=7951734201:AAH-s0dzyJV4aOeTtO76Zj7Y9koKewimdks
ADMIN_ID=827456169
WEBAPP_URL=http://85.198.83.41:3000
MONGODB_URI=mongodb://localhost:27017/mactabak_shop
ADMIN_PASSWORD=f3-YmUt2AP-JYt
JWT_SECRET=super-secret-jwt-key-for-admin-panel-2024
SESSION_SECRET=super-secret-session-key-2024
NODE_ENV=production
PORT=3000
MANAGER_EMAIL=chek_qr@bk.ru
PAYMENT_NAME=ИНДИВИДУАЛЬНЫЙ ПРЕДПРИНИМАТЕЛЬ ГУСЕВ ДМИТРИЙ АНАТОЛЬЕВИЧ
PAYMENT_INN=530204186437
PAYMENT_ACCOUNT=40802810200003565112
PAYMENT_BIK=044525974
GITHUB_REPO=https://github.com/artemperekrestov777-lab/webappmactabakshop.git
EOF
```

### 6. Создание необходимых папок
```bash
# Создаем папки для данных
mkdir -p data/qr
mkdir -p logs
```

### 7. Запуск проекта с PM2
```bash
# Запускаем бота с PM2
pm2 start bot/index.js --name "mactabak-bot"

# Настраиваем автозапуск
pm2 startup
pm2 save

# Проверяем статус
pm2 status
```

### 8. Открытие порта 3000 (если нужно)
```bash
# Проверяем firewall
ufw status

# Открываем порт 3000 если нужно
ufw allow 3000/tcp

# Проверяем, что приложение работает
curl http://localhost:3000
```

## ✅ Проверка работы:

### 1. Проверить статус PM2:
```bash
pm2 status
pm2 logs mactabak-bot
```

### 2. Проверить работу бота:
- Написать боту `/start` в Telegram
- Попробовать команду `/admin f3-YmUt2AP-JYt`

### 3. Проверить админ-панель:
- Открыть в браузере: `http://85.198.83.41:3000/admin.html`

## 🔄 Обновление кода:
```bash
cd /root/webappmactabakshop
git pull origin main
npm install
pm2 restart mactabak-bot
```

## 📝 Полезные команды PM2:
```bash
pm2 status          # Статус всех процессов
pm2 logs             # Просмотр логов
pm2 restart all      # Перезапуск всех процессов
pm2 stop all         # Остановка всех процессов
pm2 delete all       # Удаление всех процессов
```

## 🎉 После выполнения:
Админ-панель будет доступна по адресу: `http://85.198.83.41:3000/admin.html`
И команда `/admin f3-YmUt2AP-JYt` в Telegram будет работать!