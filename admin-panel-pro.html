<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–∞–∫–¢–∞–±–∞–∫ Pro - –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</title>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #667eea;
            --primary-dark: #5a67d8;
            --secondary: #764ba2;
            --success: #48bb78;
            --danger: #f56565;
            --warning: #ed8936;
            --info: #4299e1;
            --dark: #2d3748;
            --light: #f7fafc;
            --border: #e2e8f0;
            --shadow: 0 10px 15px -3px rgba(0,0,0,0.1);
            --shadow-lg: 0 20px 25px -5px rgba(0,0,0,0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* –≠–∫—Ä–∞–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ */
        .auth-container {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: var(--shadow-lg);
            width: 100%;
            max-width: 400px;
            animation: slideUp 0.5s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .auth-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .auth-header h1 {
            color: var(--primary);
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .auth-header p {
            color: #718096;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--dark);
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border);
            border-radius: 0.5rem;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102,126,234,0.1);
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            width: 100%;
            justify-content: center;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∞–¥–º–∏–Ω–∫–∏ */
        .admin-container {
            display: none;
            width: 100%;
            height: 100vh;
            background: var(--light);
        }

        /* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å */
        .header {
            background: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .header-title h1 {
            color: var(--dark);
            font-size: 1.5rem;
        }

        .stats-badge {
            background: var(--primary);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.875rem;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
        }

        .btn-secondary {
            background: var(--light);
            color: var(--dark);
            border: 2px solid var(--border);
        }

        .btn-secondary:hover {
            background: white;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç */
        .main-content {
            display: flex;
            height: calc(100vh - 70px);
        }

        /* –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å */
        .sidebar {
            width: 250px;
            background: white;
            border-right: 1px solid var(--border);
            padding: 1rem;
            overflow-y: auto;
        }

        .sidebar-section {
            margin-bottom: 2rem;
        }

        .sidebar-title {
            color: #718096;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem;
            border-radius: 0.5rem;
            color: var(--dark);
            text-decoration: none;
            transition: all 0.2s;
            margin-bottom: 0.25rem;
            cursor: pointer;
        }

        .nav-item:hover {
            background: var(--light);
        }

        .nav-item.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
        }

        /* –ö–æ–Ω—Ç–µ–Ω—Ç */
        .content {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
        }

        /* –°–µ–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π */
        .upload-section {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
        }

        .upload-title {
            font-size: 1.25rem;
            color: var(--dark);
            margin-bottom: 1rem;
        }

        /* Drag & Drop –∑–æ–Ω–∞ */
        .drop-zone {
            border: 3px dashed var(--border);
            border-radius: 1rem;
            padding: 3rem;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
            background: #fafafa;
        }

        .drop-zone.dragover {
            border-color: var(--primary);
            background: rgba(102,126,234,0.05);
            transform: scale(1.02);
        }

        .drop-zone-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .drop-zone-text {
            color: var(--dark);
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
        }

        .drop-zone-hint {
            color: #718096;
            font-size: 0.875rem;
        }

        .file-input {
            display: none;
        }

        /* –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π */
        .image-preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }

        .image-preview-item {
            position: relative;
            border-radius: 0.5rem;
            overflow: hidden;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }

        .image-preview-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .image-preview-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }

        .image-preview-remove {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: var(--danger);
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: all 0.3s;
        }

        .image-preview-item:hover .image-preview-remove {
            opacity: 1;
        }

        .image-preview-info {
            padding: 0.5rem;
            font-size: 0.75rem;
            color: #718096;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä */
        .upload-progress {
            display: none;
            margin-top: 1rem;
        }

        .progress-bar {
            height: 8px;
            background: var(--border);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            width: 0%;
            transition: width 0.3s;
        }

        .progress-text {
            margin-top: 0.5rem;
            color: #718096;
            font-size: 0.875rem;
        }

        /* –§–æ—Ä–º–∞ —Ç–æ–≤–∞—Ä–∞ */
        .product-form {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: var(--shadow);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border);
            border-radius: 0.5rem;
            font-size: 1rem;
            background: white;
            transition: all 0.3s;
        }

        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border);
            border-radius: 0.5rem;
            font-size: 1rem;
            resize: vertical;
            min-height: 100px;
            transition: all 0.3s;
        }

        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102,126,234,0.1);
        }

        /* –¢–∞–±–ª–∏—Ü–∞ —Ç–æ–≤–∞—Ä–æ–≤ */
        .products-table {
            background: white;
            border-radius: 1rem;
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .table-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-title {
            font-size: 1.25rem;
            color: var(--dark);
        }

        .search-box {
            position: relative;
        }

        .search-box input {
            padding: 0.5rem 2.5rem 0.5rem 1rem;
            border: 2px solid var(--border);
            border-radius: 0.5rem;
            width: 300px;
        }

        .search-box-icon {
            position: absolute;
            right: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: #718096;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: var(--light);
        }

        th {
            padding: 1rem;
            text-align: left;
            color: #718096;
            font-weight: 600;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        td {
            padding: 1rem;
            border-top: 1px solid var(--border);
        }

        tr:hover {
            background: #fafafa;
        }

        .product-image-cell {
            width: 60px;
        }

        .product-image-cell img {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 0.5rem;
        }

        .product-images-count {
            background: var(--info);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 1rem;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.25rem;
            color: var(--dark);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #718096;
            cursor: pointer;
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-footer {
            padding: 1.5rem;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .stat-icon.primary {
            background: rgba(102,126,234,0.1);
            color: var(--primary);
        }

        .stat-icon.success {
            background: rgba(72,187,120,0.1);
            color: var(--success);
        }

        .stat-icon.warning {
            background: rgba(237,137,54,0.1);
            color: var(--warning);
        }

        .stat-icon.info {
            background: rgba(66,153,225,0.1);
            color: var(--info);
        }

        .stat-details {
            flex: 1;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--dark);
        }

        .stat-label {
            color: #718096;
            font-size: 0.875rem;
        }

        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .notification {
            position: fixed;
            top: 2rem;
            right: 2rem;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            color: white;
            font-weight: 500;
            animation: slideIn 0.3s ease;
            z-index: 2000;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
            }
            to {
                transform: translateX(0);
            }
        }

        .notification.success {
            background: var(--success);
        }

        .notification.error {
            background: var(--danger);
        }

        .notification.warning {
            background: var(--warning);
        }

        /* –õ–æ–∞–¥–µ—Ä */
        .loader-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255,255,255,0.9);
            z-index: 3000;
            align-items: center;
            justify-content: center;
        }

        .loader-overlay.active {
            display: flex;
        }

        .loader {
            width: 50px;
            height: 50px;
            border: 4px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .loader-text {
            margin-top: 1rem;
            color: var(--dark);
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }

            .header {
                padding: 1rem;
            }

            .content {
                padding: 1rem;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .search-box input {
                width: 200px;
            }
        }
    </style>
</head>
<body>
    <!-- –≠–∫—Ä–∞–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
    <div id="authContainer" class="auth-container">
        <div class="auth-header">
            <h1>üö¨ –ú–∞–∫–¢–∞–±–∞–∫ Pro</h1>
            <p>–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</p>
        </div>
        <form id="authForm">
            <div class="form-group">
                <label>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                <input type="text" id="username" required placeholder="admin">
            </div>
            <div class="form-group">
                <label>–ü–∞—Ä–æ–ª—å</label>
                <input type="password" id="password" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            </div>
            <button type="submit" class="btn btn-primary">
                <span>üîê</span>
                <span>–í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É</span>
            </button>
        </form>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∞–¥–º–∏–Ω–∫–∏ -->
    <div id="adminContainer" class="admin-container">
        <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å -->
        <header class="header">
            <div class="header-title">
                <h1>–ú–∞–∫–¢–∞–±–∞–∫ Admin</h1>
                <div class="stats-badge" id="totalProductsBadge">0 —Ç–æ–≤–∞—Ä–æ–≤</div>
            </div>
            <div class="header-actions">
                <button class="btn btn-secondary" onclick="createBackup()">
                    üíæ –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è
                </button>
                <button class="btn btn-secondary" onclick="showStats()">
                    üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                </button>
                <button class="btn btn-danger" onclick="logout()">
                    üö™ –í—ã—Ö–æ–¥
                </button>
            </div>
        </header>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <div class="main-content">
            <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
            <aside class="sidebar">
                <div class="sidebar-section">
                    <div class="sidebar-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</div>
                    <a class="nav-item active" onclick="showSection('dashboard')">
                        üìä –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                    </a>
                    <a class="nav-item" onclick="showSection('products')">
                        üì¶ –¢–æ–≤–∞—Ä—ã
                    </a>
                    <a class="nav-item" onclick="showSection('upload')">
                        üñºÔ∏è –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
                    </a>
                    <a class="nav-item" onclick="showSection('logs')">
                        üìú –õ–æ–≥–∏
                    </a>
                </div>
                <div class="sidebar-section">
                    <div class="sidebar-title">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</div>
                    <a class="nav-item" onclick="filterByCategory('all')">–í—Å–µ —Ç–æ–≤–∞—Ä—ã</a>
                    <a class="nav-item" onclick="filterByCategory('new')">üÜï –ù–æ–≤–∏–Ω–∫–∏</a>
                    <a class="nav-item" onclick="filterByCategory('standard')">üö¨ –°—Ç–∞–Ω–¥–∞—Ä—Ç</a>
                    <a class="nav-item" onclick="filterByCategory('aromatic')">üå∏ –ê—Ä–æ–º–∞—Ç–Ω—ã–µ</a>
                    <a class="nav-item" onclick="filterByCategory('pipes')">üö∞ –¢—Ä—É–±–∫–∏</a>
                    <a class="nav-item" onclick="filterByCategory('machines')">‚öôÔ∏è –ú–∞—à–∏–Ω–∫–∏</a>
                </div>
            </aside>

            <!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
            <main class="content">
                <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
                <div id="dashboardSection">
                    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon primary">üì¶</div>
                            <div class="stat-details">
                                <div class="stat-value" id="statProducts">0</div>
                                <div class="stat-label">–í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon success">üñºÔ∏è</div>
                            <div class="stat-details">
                                <div class="stat-value" id="statImages">0</div>
                                <div class="stat-label">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon warning">üíæ</div>
                            <div class="stat-details">
                                <div class="stat-value" id="statStorage">0 MB</div>
                                <div class="stat-label">–ó–∞–Ω—è—Ç–æ –º–µ—Å—Ç–∞</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon info">üìÖ</div>
                            <div class="stat-details">
                                <div class="stat-value" id="statBackup">–ù–∏–∫–æ–≥–¥–∞</div>
                                <div class="stat-label">–ü–æ—Å–ª–µ–¥–Ω–∏–π –±—ç–∫–∞–ø</div>
                            </div>
                        </div>
                    </div>

                    <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ -->
                    <div class="product-form">
                        <h2 class="upload-title">‚ûï –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–æ–≤–∞—Ä–∞</h2>
                        <form id="productForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ *</label>
                                    <input type="text" id="productName" required placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –¢—Ä—É–±–∫–∞ Mr Burning">
                                </div>
                                <div class="form-group">
                                    <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è *</label>
                                    <select id="productCategory" required>
                                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                                        <option value="new">üÜï –ù–æ–≤–∏–Ω–∫–∏</option>
                                        <option value="standard">üö¨ –°—Ç–∞–Ω–¥–∞—Ä—Ç</option>
                                        <option value="aromatic">üå∏ –ê—Ä–æ–º–∞—Ç–Ω—ã–µ</option>
                                        <option value="pipes">üö∞ –¢—Ä—É–±–∫–∏</option>
                                        <option value="machines">‚öôÔ∏è –ú–∞—à–∏–Ω–∫–∏</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>–¶–µ–Ω–∞ (‚ÇΩ) *</label>
                                    <input type="number" id="productPrice" required placeholder="1500" min="0">
                                </div>
                                <div class="form-group">
                                    <label>–ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è *</label>
                                    <select id="productUnit" required onchange="toggleWeightField()">
                                        <option value="piece">–®—Ç—É–∫–∞</option>
                                        <option value="weight">–í–µ—Å</option>
                                    </select>
                                </div>
                                <div class="form-group" id="weightGroup" style="display: none;">
                                    <label>–í–µ—Å —É–ø–∞–∫–æ–≤–∫–∏ (–≥)</label>
                                    <input type="number" id="productWeight" placeholder="50" min="0">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>–û–ø–∏—Å–∞–Ω–∏–µ</label>
                                <textarea id="productDescription" placeholder="–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞..."></textarea>
                            </div>
                            <div class="form-group">
                                <label>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞</label>
                                <div class="drop-zone" id="productDropZone">
                                    <div class="drop-zone-icon">üì∏</div>
                                    <div class="drop-zone-text">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—é–¥–∞</div>
                                    <div class="drop-zone-hint">–∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ (–¥–æ 10 —Ñ–∞–π–ª–æ–≤)</div>
                                    <input type="file" id="productImages" class="file-input" accept="image/*" multiple>
                                </div>
                                <div id="productImagePreview" class="image-preview-grid"></div>
                            </div>
                            <button type="submit" class="btn btn-success">
                                ‚úÖ –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä
                            </button>
                        </form>
                    </div>
                </div>

                <!-- –°–µ–∫—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤ -->
                <div id="productsSection" style="display: none;">
                    <div class="products-table">
                        <div class="table-header">
                            <h2 class="table-title">üì¶ –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤</h2>
                            <div class="search-box">
                                <input type="text" id="productSearch" placeholder="–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤...">
                                <span class="search-box-icon">üîç</span>
                            </div>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>–§–æ—Ç–æ</th>
                                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                    <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                                    <th>–¶–µ–Ω–∞</th>
                                    <th>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody id="productsTableBody">
                                <!-- –¢–æ–≤–∞—Ä—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —Å—é–¥–∞ -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- –°–µ–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π -->
                <div id="uploadSection" style="display: none;">
                    <div class="upload-section">
                        <h2 class="upload-title">üñºÔ∏è –ú–∞—Å—Å–æ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</h2>
                        <div class="drop-zone" id="massDropZone">
                            <div class="drop-zone-icon">üì§</div>
                            <div class="drop-zone-text">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –¥–æ 10 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</div>
                            <div class="drop-zone-hint">JPG, PNG, WebP ‚Ä¢ –ú–∞–∫—Å. 10 MB –Ω–∞ —Ñ–∞–π–ª</div>
                            <input type="file" id="massUploadInput" class="file-input" accept="image/*" multiple>
                        </div>
                        <div class="upload-progress" id="uploadProgress">
                            <div class="progress-bar">
                                <div class="progress-bar-fill" id="progressBarFill"></div>
                            </div>
                            <div class="progress-text" id="progressText">–ó–∞–≥—Ä—É–∑–∫–∞: 0%</div>
                        </div>
                        <div id="uploadPreview" class="image-preview-grid"></div>
                    </div>
                </div>

                <!-- –°–µ–∫—Ü–∏—è –ª–æ–≥–æ–≤ -->
                <div id="logsSection" style="display: none;">
                    <div class="products-table">
                        <div class="table-header">
                            <h2 class="table-title">üìú –ñ—É—Ä–Ω–∞–ª –¥–µ–π—Å—Ç–≤–∏–π</h2>
                            <button class="btn btn-secondary" onclick="loadLogs()">
                                üîÑ –û–±–Ω–æ–≤–∏—Ç—å
                            </button>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>–í—Ä–µ–º—è</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
                                    <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                                    <th>–î–µ—Ç–∞–ª–∏</th>
                                </tr>
                            </thead>
                            <tbody id="logsTableBody">
                                <!-- –õ–æ–≥–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —Å—é–¥–∞ -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</h3>
                <button class="modal-close" onclick="closeEditModal()">‚úï</button>
            </div>
            <div class="modal-body">
                <form id="editForm">
                    <input type="hidden" id="editProductId">
                    <div class="form-row">
                        <div class="form-group">
                            <label>–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</label>
                            <input type="text" id="editName" required>
                        </div>
                        <div class="form-group">
                            <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                            <select id="editCategory" required>
                                <option value="new">üÜï –ù–æ–≤–∏–Ω–∫–∏</option>
                                <option value="standard">üö¨ –°—Ç–∞–Ω–¥–∞—Ä—Ç</option>
                                <option value="aromatic">üå∏ –ê—Ä–æ–º–∞—Ç–Ω—ã–µ</option>
                                <option value="pipes">üö∞ –¢—Ä—É–±–∫–∏</option>
                                <option value="machines">‚öôÔ∏è –ú–∞—à–∏–Ω–∫–∏</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>–¶–µ–Ω–∞ (‚ÇΩ)</label>
                            <input type="number" id="editPrice" required min="0">
                        </div>
                        <div class="form-group">
                            <label>–ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è</label>
                            <select id="editUnit" required>
                                <option value="piece">–®—Ç—É–∫–∞</option>
                                <option value="weight">–í–µ—Å</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea id="editDescription"></textarea>
                    </div>
                    <div class="form-group">
                        <label>–¢–µ–∫—É—â–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</label>
                        <div id="editImagePreview" class="image-preview-grid"></div>
                    </div>
                    <div class="form-group">
                        <label>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</label>
                        <input type="file" id="editNewImages" accept="image/*" multiple class="form-control">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeEditModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" onclick="saveEditedProduct()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –õ–æ–∞–¥–µ—Ä -->
    <div id="loader" class="loader-overlay">
        <div>
            <div class="loader"></div>
            <div class="loader-text">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // ============================
        // –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø
        // ============================
        const API_URL = window.location.hostname === 'localhost'
            ? 'http://localhost:3001/api'
            : 'http://85.198.83.41:3001/api';

        let authToken = localStorage.getItem('adminToken');
        let products = [];
        let selectedFiles = [];
        let currentEditProduct = null;

        // ============================
        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
        // ============================
        document.addEventListener('DOMContentLoaded', () => {
            if (authToken) {
                showAdminPanel();
                loadProducts();
                loadStats();
            }

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ñ–æ—Ä–º
            document.getElementById('authForm').addEventListener('submit', handleLogin);
            document.getElementById('productForm').addEventListener('submit', handleProductSubmit);

            // Drag & Drop –¥–ª—è —Ñ–æ—Ä–º—ã —Ç–æ–≤–∞—Ä–∞
            setupDropZone('productDropZone', 'productImages', 'productImagePreview');

            // Drag & Drop –¥–ª—è –º–∞—Å—Å–æ–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
            setupDropZone('massDropZone', 'massUploadInput', 'uploadPreview', true);

            // –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤
            document.getElementById('productSearch').addEventListener('input', (e) => {
                filterProducts(e.target.value);
            });
        });

        // ============================
        // –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø
        // ============================
        async function handleLogin(e) {
            e.preventDefault();
            showLoader();

            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            try {
                const response = await fetch(`${API_URL}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });

                const result = await response.json();

                if (result.success) {
                    authToken = result.token;
                    localStorage.setItem('adminToken', authToken);
                    showNotification('–£—Å–ø–µ—à–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è!', 'success');
                    showAdminPanel();
                    loadProducts();
                    loadStats();
                } else {
                    showNotification(result.error || '–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏', 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É', 'error');
                console.error(error);
            } finally {
                hideLoader();
            }
        }

        function logout() {
            localStorage.removeItem('adminToken');
            authToken = null;
            location.reload();
        }

        function showAdminPanel() {
            document.getElementById('authContainer').style.display = 'none';
            document.getElementById('adminContainer').style.display = 'block';
        }

        // ============================
        // DRAG & DROP
        // ============================
        function setupDropZone(dropZoneId, inputId, previewId, isMassUpload = false) {
            const dropZone = document.getElementById(dropZoneId);
            const input = document.getElementById(inputId);
            const preview = document.getElementById(previewId);

            if (!dropZone || !input) return;

            // –ö–ª–∏–∫ –Ω–∞ –∑–æ–Ω—É
            dropZone.addEventListener('click', () => input.click());

            // –í—ã–±–æ—Ä —Ñ–∞–π–ª–æ–≤
            input.addEventListener('change', (e) => {
                const files = Array.from(e.target.files);
                if (isMassUpload) {
                    handleMassUpload(files);
                } else {
                    handleFiles(files, preview);
                }
            });

            // Drag & Drop —Å–æ–±—ã—Ç–∏—è
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            ['dragenter', 'dragover'].forEach(eventName => {
                dropZone.addEventListener(eventName, () => {
                    dropZone.classList.add('dragover');
                }, false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, () => {
                    dropZone.classList.remove('dragover');
                }, false);
            });

            dropZone.addEventListener('drop', (e) => {
                const files = Array.from(e.dataTransfer.files);
                if (isMassUpload) {
                    handleMassUpload(files);
                } else {
                    handleFiles(files, preview);
                }
            });
        }

        function handleFiles(files, previewContainer) {
            const imageFiles = files.filter(f => f.type.startsWith('image/'));

            if (imageFiles.length > 10) {
                showNotification('–ú–∞–∫—Å–∏–º—É–º 10 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∑–∞ —Ä–∞–∑', 'warning');
                imageFiles.splice(10);
            }

            selectedFiles = [...selectedFiles, ...imageFiles];

            if (previewContainer) {
                displayPreview(selectedFiles, previewContainer);
            }
        }

        function displayPreview(files, container) {
            container.innerHTML = '';

            files.forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const item = document.createElement('div');
                    item.className = 'image-preview-item';
                    item.innerHTML = `
                        <img src="${e.target.result}" alt="${file.name}">
                        <button class="image-preview-remove" onclick="removeFile(${index})">‚úï</button>
                        <div class="image-preview-info">${file.name}</div>
                    `;
                    container.appendChild(item);
                };
                reader.readAsDataURL(file);
            });
        }

        function removeFile(index) {
            selectedFiles.splice(index, 1);
            displayPreview(selectedFiles, document.getElementById('productImagePreview'));
        }

        // ============================
        // –ú–ê–°–°–û–í–ê–Ø –ó–ê–ì–†–£–ó–ö–ê
        // ============================
        async function handleMassUpload(files) {
            const imageFiles = files.filter(f => f.type.startsWith('image/'));

            if (imageFiles.length === 0) {
                showNotification('–í—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏', 'warning');
                return;
            }

            if (imageFiles.length > 10) {
                showNotification('–ú–∞–∫—Å–∏–º—É–º 10 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∑–∞ —Ä–∞–∑', 'warning');
                imageFiles.splice(10);
            }

            showLoader();
            const progressDiv = document.getElementById('uploadProgress');
            const progressBar = document.getElementById('progressBarFill');
            const progressText = document.getElementById('progressText');

            progressDiv.style.display = 'block';

            const formData = new FormData();
            imageFiles.forEach(file => {
                formData.append('photos', file);
            });

            try {
                const xhr = new XMLHttpRequest();

                xhr.upload.addEventListener('progress', (e) => {
                    if (e.lengthComputable) {
                        const percent = Math.round((e.loaded / e.total) * 100);
                        progressBar.style.width = percent + '%';
                        progressText.textContent = `–ó–∞–≥—Ä—É–∑–∫–∞: ${percent}%`;
                    }
                });

                xhr.onload = function() {
                    if (xhr.status === 200) {
                        const result = JSON.parse(xhr.responseText);
                        if (result.success) {
                            showNotification(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${result.images.length} –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π`, 'success');
                            displayUploadedImages(result.images);
                        } else {
                            showNotification(result.error || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏', 'error');
                        }
                    } else {
                        showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞', 'error');
                    }
                    hideLoader();
                    progressDiv.style.display = 'none';
                };

                xhr.onerror = function() {
                    showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', 'error');
                    hideLoader();
                    progressDiv.style.display = 'none';
                };

                xhr.open('POST', `${API_URL}/admin/upload/multiple`);
                xhr.setRequestHeader('Authorization', `Bearer ${authToken}`);
                xhr.send(formData);

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤', 'error');
                hideLoader();
                progressDiv.style.display = 'none';
            }
        }

        function displayUploadedImages(images) {
            const container = document.getElementById('uploadPreview');
            container.innerHTML = '';

            images.forEach(img => {
                const item = document.createElement('div');
                item.className = 'image-preview-item';
                item.innerHTML = `
                    <img src="${img.thumbnails.medium}" alt="${img.originalName}">
                    <div class="image-preview-info">${img.originalName}</div>
                `;
                container.appendChild(item);
            });
        }

        // ============================
        // –£–ü–†–ê–í–õ–ï–ù–ò–ï –¢–û–í–ê–†–ê–ú–ò
        // ============================
        async function loadProducts() {
            try {
                const response = await fetch(`${API_URL}/admin/products`);
                const result = await response.json();

                if (result.success) {
                    products = result.products;
                    displayProducts(products);
                    document.getElementById('totalProductsBadge').textContent = `${products.length} —Ç–æ–≤–∞—Ä–æ–≤`;
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤:', error);
            }
        }

        function displayProducts(productsList) {
            const tbody = document.getElementById('productsTableBody');
            tbody.innerHTML = '';

            productsList.forEach(product => {
                const tr = document.createElement('tr');
                const firstImage = product.images && product.images[0]
                    ? product.images[0].thumbnails?.thumb || product.images[0].original
                    : '/storage/products/thumb/default.jpg';

                tr.innerHTML = `
                    <td class="product-image-cell">
                        <img src="${firstImage}" alt="${product.name}" onerror="this.src='/storage/products/thumb/default.jpg'">
                    </td>
                    <td>${product.name}</td>
                    <td>${getCategoryLabel(product.category)}</td>
                    <td>${product.price} ‚ÇΩ</td>
                    <td>
                        <span class="product-images-count">${product.images?.length || 0} —Ñ–æ—Ç–æ</span>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-sm btn-primary" onclick="editProduct('${product._id}')">‚úèÔ∏è</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteProduct('${product._id}')">üóëÔ∏è</button>
                        </div>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function getCategoryLabel(category) {
            const labels = {
                'new': 'üÜï –ù–æ–≤–∏–Ω–∫–∏',
                'standard': 'üö¨ –°—Ç–∞–Ω–¥–∞—Ä—Ç',
                'aromatic': 'üå∏ –ê—Ä–æ–º–∞—Ç–Ω—ã–µ',
                'pipes': 'üö∞ –¢—Ä—É–±–∫–∏',
                'machines': '‚öôÔ∏è –ú–∞—à–∏–Ω–∫–∏'
            };
            return labels[category] || category;
        }

        async function handleProductSubmit(e) {
            e.preventDefault();
            showLoader();

            const formData = new FormData();
            const productData = {
                name: document.getElementById('productName').value,
                category: document.getElementById('productCategory').value,
                price: parseFloat(document.getElementById('productPrice').value),
                unit: document.getElementById('productUnit').value,
                description: document.getElementById('productDescription').value
            };

            if (productData.unit === 'weight') {
                productData.packageWeight = parseInt(document.getElementById('productWeight').value) || 50;
            }

            formData.append('productData', JSON.stringify(productData));

            // –î–æ–±–∞–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            selectedFiles.forEach(file => {
                formData.append('photos', file);
            });

            try {
                const response = await fetch(`${API_URL}/admin/product`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: formData
                });

                const result = await response.json();

                if (result.success) {
                    showNotification('–¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!', 'success');
                    document.getElementById('productForm').reset();
                    selectedFiles = [];
                    document.getElementById('productImagePreview').innerHTML = '';
                    loadProducts();
                    loadStats();
                } else {
                    showNotification(result.error || '–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞', 'error');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º', 'error');
            } finally {
                hideLoader();
            }
        }

        function editProduct(productId) {
            const product = products.find(p => p._id === productId);
            if (!product) return;

            currentEditProduct = product;

            document.getElementById('editProductId').value = product._id;
            document.getElementById('editName').value = product.name;
            document.getElementById('editCategory').value = product.category;
            document.getElementById('editPrice').value = product.price;
            document.getElementById('editUnit').value = product.unit;
            document.getElementById('editDescription').value = product.description || '';

            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ç–µ–∫—É—â–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            const imagePreview = document.getElementById('editImagePreview');
            imagePreview.innerHTML = '';

            if (product.images && product.images.length > 0) {
                product.images.forEach(img => {
                    const item = document.createElement('div');
                    item.className = 'image-preview-item';
                    item.innerHTML = `
                        <img src="${img.thumbnails?.thumb || img.original}" alt="">
                        <button class="image-preview-remove" onclick="removeProductImage('${product._id}', '${img.id}')">‚úï</button>
                    `;
                    imagePreview.appendChild(item);
                });
            }

            document.getElementById('editModal').classList.add('active');
        }

        async function saveEditedProduct() {
            showLoader();

            const productId = document.getElementById('editProductId').value;
            const formData = new FormData();

            const productData = {
                name: document.getElementById('editName').value,
                category: document.getElementById('editCategory').value,
                price: parseFloat(document.getElementById('editPrice').value),
                unit: document.getElementById('editUnit').value,
                description: document.getElementById('editDescription').value
            };

            formData.append('productData', JSON.stringify(productData));

            // –ù–æ–≤—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            const newImages = document.getElementById('editNewImages').files;
            for (let i = 0; i < newImages.length; i++) {
                formData.append('photos', newImages[i]);
            }

            try {
                const response = await fetch(`${API_URL}/admin/product/${productId}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: formData
                });

                const result = await response.json();

                if (result.success) {
                    showNotification('–¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!', 'success');
                    closeEditModal();
                    loadProducts();
                } else {
                    showNotification(result.error || '–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è', 'error');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', 'error');
            } finally {
                hideLoader();
            }
        }

        async function deleteProduct(productId) {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç–æ–≤–∞—Ä?')) return;

            showLoader();

            try {
                const response = await fetch(`${API_URL}/admin/product/${productId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                const result = await response.json();

                if (result.success) {
                    showNotification('–¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω!', 'success');
                    loadProducts();
                    loadStats();
                } else {
                    showNotification(result.error || '–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è', 'error');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', 'error');
            } finally {
                hideLoader();
            }
        }

        async function removeProductImage(productId, imageId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ?')) return;

            showLoader();

            try {
                const response = await fetch(`${API_URL}/admin/image/${productId}/${imageId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                const result = await response.json();

                if (result.success) {
                    showNotification('–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ!', 'success');
                    loadProducts();
                    editProduct(productId); // –û–±–Ω–æ–≤–ª—è–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                } else {
                    showNotification(result.error || '–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è', 'error');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', 'error');
            } finally {
                hideLoader();
            }
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.remove('active');
            document.getElementById('editNewImages').value = '';
        }

        // ============================
        // –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ò –õ–û–ì–ò
        // ============================
        async function loadStats() {
            try {
                const response = await fetch(`${API_URL}/admin/stats`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                const result = await response.json();

                if (result.success) {
                    document.getElementById('statProducts').textContent = result.stats.totalProducts;
                    document.getElementById('statImages').textContent = result.stats.totalImages;
                    document.getElementById('statStorage').textContent = result.stats.storageSize;

                    const lastBackup = result.stats.lastBackup;
                    if (lastBackup && lastBackup !== '–ù–∏–∫–æ–≥–¥–∞') {
                        const date = new Date(lastBackup);
                        document.getElementById('statBackup').textContent = date.toLocaleString('ru-RU');
                    }
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
            }
        }

        async function loadLogs() {
            showLoader();

            try {
                const response = await fetch(`${API_URL}/admin/logs?limit=50`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                const result = await response.json();

                if (result.success) {
                    const tbody = document.getElementById('logsTableBody');
                    tbody.innerHTML = '';

                    result.logs.forEach(log => {
                        const tr = document.createElement('tr');
                        const date = new Date(log.timestamp);

                        tr.innerHTML = `
                            <td>${date.toLocaleString('ru-RU')}</td>
                            <td>${log.action}</td>
                            <td>User ${log.userId}</td>
                            <td>${JSON.stringify(log.details)}</td>
                        `;
                        tbody.appendChild(tr);
                    });
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–≥–æ–≤:', error);
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–≥–æ–≤', 'error');
            } finally {
                hideLoader();
            }
        }

        async function createBackup() {
            if (!confirm('–°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö?')) return;

            showLoader();

            try {
                const response = await fetch(`${API_URL}/admin/backup`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                const result = await response.json();

                if (result.success) {
                    showNotification('–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —Å–æ–∑–¥–∞–Ω–∞!', 'success');
                    loadStats();
                } else {
                    showNotification(result.error || '–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –±—ç–∫–∞–ø–∞', 'error');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', 'error');
            } finally {
                hideLoader();
            }
        }

        // ============================
        // UI –§–£–ù–ö–¶–ò–ò
        // ============================
        function showSection(section) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å–µ–∫—Ü–∏–∏
            document.getElementById('dashboardSection').style.display = 'none';
            document.getElementById('productsSection').style.display = 'none';
            document.getElementById('uploadSection').style.display = 'none';
            document.getElementById('logsSection').style.display = 'none';

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—É—é
            switch(section) {
                case 'dashboard':
                    document.getElementById('dashboardSection').style.display = 'block';
                    break;
                case 'products':
                    document.getElementById('productsSection').style.display = 'block';
                    loadProducts();
                    break;
                case 'upload':
                    document.getElementById('uploadSection').style.display = 'block';
                    break;
                case 'logs':
                    document.getElementById('logsSection').style.display = 'block';
                    loadLogs();
                    break;
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –ø—É–Ω–∫—Ç –º–µ–Ω—é
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        function filterByCategory(category) {
            if (category === 'all') {
                displayProducts(products);
            } else {
                const filtered = products.filter(p => p.category === category);
                displayProducts(filtered);
            }
            showSection('products');
        }

        function filterProducts(searchTerm) {
            const filtered = products.filter(p =>
                p.name.toLowerCase().includes(searchTerm.toLowerCase())
            );
            displayProducts(filtered);
        }

        function toggleWeightField() {
            const unit = document.getElementById('productUnit').value;
            const weightGroup = document.getElementById('weightGroup');
            weightGroup.style.display = unit === 'weight' ? 'block' : 'none';
        }

        function showStats() {
            loadStats();
            showSection('dashboard');
        }

        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        function showLoader() {
            document.getElementById('loader').classList.add('active');
        }

        function hideLoader() {
            document.getElementById('loader').classList.remove('active');
        }
    </script>
</body>
</html>